# ğŸ“Š DIAGRAMA TÃ‰CNICO: Antes vs DespuÃ©s

## âŒ ARQUITECTURA ANTES (INCORRECTA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TABLA STAGING: infoventas                    â”‚
â”‚                  (Datos sin clasificar)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ID | Fecha | Producto | Cantidad | Tipo | Vta neta | ... â”‚ â”‚
â”‚  â”‚ 1  | 2024-01-01 | X | 10 | 0 (factura) | 1000 | ... â”‚ â”‚
â”‚  â”‚ 2  | 2024-01-02 | Y | 5 | 1 (devoluciÃ³n) | -500 | ... â”‚  â”‚
â”‚  â”‚ ... (mÃ¡s registros)                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sp_infoventas_migrate_pending()       â”‚
        â”‚ (Migra a tabla anual)                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TABLA ANUAL: infoventas_2024                       â”‚
â”‚           (TODAS las ventas del aÃ±o sin clasificar)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ID | Fecha | Producto | Cantidad | Tipo | Vta neta | ... â”‚ â”‚
â”‚  â”‚ 1  | 2024-01-01 | X | 10 | 0 | 1000 | ... â”‚  â”‚
â”‚  â”‚ 2  | 2024-01-02 | Y | 5 | 1 | -500 | ... â”‚  â”‚
â”‚  â”‚ ... (15,000 registros)                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Clasificar por   â”‚    â”‚ Clasificar por   â”‚
        â”‚ Tipo = 0 (fact)  â”‚    â”‚ Tipo = 1 (dev)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ infoventas_2024_fact â”‚  â”‚ infoventas_2024_dev  â”‚
    â”‚ (Facturas)           â”‚  â”‚ (Devoluciones)       â”‚
    â”‚ 12,100 registros     â”‚  â”‚ 2,900 registros      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sp_infoventas_rebuild_view()     â”‚
        â”‚ (âŒ INCLUYE TODAS LAS TABLAS)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VISTA: vw_infoventas                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2024           â”‚â”‚ â† âŒ COMPLETA
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2024_fact      â”‚â”‚ â† âœ… FACT
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2024_dev       â”‚â”‚ â† âœ… DEV
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2025           â”‚â”‚ â† âŒ COMPLETA
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2025_fact      â”‚â”‚ â† âœ… FACT
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2025_dev       â”‚â”‚ â† âœ… DEV
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚                                             â”‚
    â”‚  RESULTADO:                                 â”‚
    â”‚  15,000 + 12,100 + 2,900 = 30,000 registrosâ”‚ â† âŒ DUPLICADOS!
    â”‚                                             â”‚
    â”‚  AÃ±o 2024 aparece 2 veces:                  â”‚
    â”‚  - En infoventas_2024 (lÃ­nea 1)             â”‚
    â”‚  - En infoventas_2024_fact + dev (lÃ­neas 3,5)
    â”‚                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ APLICACIÃ“N/REPORTING  â”‚
            â”‚ (USA vw_infoventas)   â”‚
            â”‚                       â”‚
            â”‚ âŒ DATOS DUPLICADOS   â”‚
            â”‚ âŒ INCONSISTENCIA     â”‚
            â”‚ âŒ NO VALIDABLE       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ARQUITECTURA DESPUÃ‰S (CORRECTA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TABLA STAGING: infoventas                    â”‚
â”‚                  (Datos sin clasificar)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ID | Fecha | Producto | Cantidad | Tipo | Vta neta | ... â”‚ â”‚
â”‚  â”‚ 1  | 2025-09-01 | X | 10 | 0 | 1000 | ... â”‚  â”‚
â”‚  â”‚ 2  | 2025-09-02 | Y | 5 | 1 | -500 | ... â”‚  â”‚
â”‚  â”‚ ... (nuevos registros prÃ³ximo mes)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sp_infoventas_migrate_pending()       â”‚
        â”‚ (Migra a tabla anual)                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TABLA ANUAL: infoventas_2025                       â”‚
â”‚           (FUENTE de datos, NO se incluye en vista)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ID | Fecha | Producto | Cantidad | Tipo | Vta neta | ... â”‚ â”‚
â”‚  â”‚ (datos aquÃ­ SOLO se usan como fuente para clasificaciÃ³n)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Clasificar por   â”‚    â”‚ Clasificar por   â”‚
        â”‚ Tipo = 0 (fact)  â”‚    â”‚ Tipo = 1 (dev)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ infoventas_2025_fact â”‚  â”‚ infoventas_2025_dev  â”‚
    â”‚ (Facturas SOLO)      â”‚  â”‚ (Devoluciones SOLO)  â”‚
    â”‚ 12,100 registros     â”‚  â”‚ 2,900 registros      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                           â–²
         â”‚ INSERT                    â”‚ INSERT
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                â”‚                  â”‚
                â”‚ (ambos SELECT desde infoventas_2025)
                â”‚                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚ DELETE FROM infoventas_2025    â”‚  â† ğŸ†• LIMPIEZA âœ…
         â”‚ (DespuÃ©s de migrar a _fact/_dev)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sp_infoventas_rebuild_view()         â”‚
        â”‚ âœ… NUEVO: Filtro SOLO _fact/_dev   â”‚
        â”‚ WHERE table LIKE '%_fact'            â”‚
        â”‚    OR table LIKE '%_dev'             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VISTA: vw_infoventas                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2024_fact      â”‚â”‚ â† âœ… FACT
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2024_dev       â”‚â”‚ â† âœ… DEV
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2025_fact      â”‚â”‚ â† âœ… FACT
    â”‚  â”‚ UNION ALL                               â”‚â”‚
    â”‚  â”‚ SELECT * FROM infoventas_2025_dev       â”‚â”‚ â† âœ… DEV
    â”‚  â”‚ (... otros aÃ±os _fact/_dev solo)        â”‚â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚                                             â”‚
    â”‚  RESULTADO:                                 â”‚
    â”‚  12,100 + 2,900 + 12,000 + 3,000 = 30,000  â”‚ â† âœ… SIN DUPLICAR!
    â”‚                                             â”‚
    â”‚  VerificaciÃ³n:                              â”‚
    â”‚  Fact + Dev = 30,000 âœ… Matches view       â”‚
    â”‚                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ DIAGNÃ“STICO AUTOMÃTICO    â”‚
            â”‚ (DespuÃ©s de cada cargue)  â”‚
            â”‚                           â”‚
            â”‚ âœ… Sin tablas anuales     â”‚
            â”‚ âœ… SOLO _fact y _dev      â”‚
            â”‚ âœ… Consistencia OK        â”‚
            â”‚ âœ… Datos validables       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ APLICACIÃ“N/REPORTING  â”‚
            â”‚ (USA vw_infoventas)   â”‚
            â”‚                       â”‚
            â”‚ âœ… DATOS CONSISTENTES â”‚
            â”‚ âœ… VALIDABLES         â”‚
            â”‚ âœ… CONFIABLES         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ EL CAMBIO EN EL CÃ“DIGO

### LÃ­nea del Cursor (EL CAMBIO CRÃTICO)

```
ANTES (âŒ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT table_name                               â”‚
â”‚ FROM information_schema.tables                  â”‚
â”‚ WHERE table_schema = DATABASE()                 â”‚
â”‚   AND table_name LIKE 'infoventas\_%'           â”‚
â”‚                                                 â”‚
â”‚ Resultado: TODAS las tablas que coincidan       â”‚
â”‚ â€¢ infoventas_2024      â† INCLUIDO (MALO)       â”‚
â”‚ â€¢ infoventas_2024_fact â† INCLUIDO (BIEN)       â”‚
â”‚ â€¢ infoventas_2024_dev  â† INCLUIDO (BIEN)       â”‚
â”‚ â€¢ infoventas_2025      â† INCLUIDO (MALO)       â”‚
â”‚ â€¢ etc.                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DESPUÃ‰S (âœ…):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT table_name                                â”‚
â”‚ FROM information_schema.tables                   â”‚
â”‚ WHERE table_schema = DATABASE()                  â”‚
â”‚   AND table_name LIKE 'infoventas\_%'            â”‚
â”‚   AND (table_name LIKE '%\_fact'                 â”‚
â”‚        OR table_name LIKE '%\_dev')              â”‚
â”‚                                                  â”‚
â”‚ Resultado: SOLO tablas que terminen en          â”‚
â”‚ â€¢ infoventas_2024_fact â† INCLUIDO (âœ…)         â”‚
â”‚ â€¢ infoventas_2024_dev  â† INCLUIDO (âœ…)         â”‚
â”‚ â€¢ infoventas_2025_fact â† INCLUIDO (âœ…)         â”‚
â”‚ â€¢ infoventas_2025_dev  â† INCLUIDO (âœ…)         â”‚
â”‚                                                  â”‚
â”‚ Excluidas:                                       â”‚
â”‚ â€¢ infoventas_2024      â† EXCLUIDO (âœ…)         â”‚
â”‚ â€¢ infoventas_2025      â† EXCLUIDO (âœ…)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š COMPARATIVA TÃ‰CNICA

| Elemento | ANTES | DESPUÃ‰S |
|----------|-------|---------|
| **Cursor WHERE** | `... LIKE 'infoventas_%'` | `... LIKE 'infoventas_%' AND (LIKE '%_fact' OR LIKE '%_dev')` |
| **Tablas incluidas** | Todas las infoventas_* | SOLO _fact y _dev |
| **Registros vista** | 30,000 (DUPLICADOS) | 30,000 (ÃšNICOS) |
| **Consistency** | âŒ No validable | âœ… Verificable |
| **DiagnÃ³stico** | âŒ Manual | âœ… AutomÃ¡tico |
| **AuditorÃ­a** | âŒ No hay | âœ… `audit_infoventas_maintenance` |

---

## ğŸ¯ IMPACTO EN DATOS

```
Escenario: Cargue de febrero 2025 (15,000 registros nuevos)

ANTES (âŒ):
â”œâ”€ infoventas_2024: 100,000 registros
â”œâ”€ infoventas_2024_fact: 80,000 registros
â”œâ”€ infoventas_2024_dev: 20,000 registros
â”œâ”€ infoventas_2025: 45,000 + 15,000 nuevos = 60,000
â”œâ”€ infoventas_2025_fact: 48,000 registros
â””â”€ infoventas_2025_dev: 12,000 registros

vw_infoventas = UNION ALL de TODAS = 100k + 80k + 20k + 60k + 48k + 12k
              = 320,000 registros âŒ DUPLICADOS

DESPUÃ‰S (âœ…):
â”œâ”€ infoventas_2024: 100,000 (no estÃ¡ en vista, es fuente)
â”œâ”€ infoventas_2024_fact: 80,000 â† en vista âœ…
â”œâ”€ infoventas_2024_dev: 20,000 â† en vista âœ…
â”œâ”€ infoventas_2025: 60,000 (no estÃ¡ en vista, es fuente)
â”œâ”€ infoventas_2025_fact: 48,000 â† en vista âœ…
â””â”€ infoventas_2025_dev: 12,000 â† en vista âœ…

vw_infoventas = UNION ALL de SOLO _fact/_dev = 80k + 20k + 48k + 12k
              = 160,000 registros âœ… SIN DUPLICAR
```

---

## ğŸ§ª VALIDACIÃ“N POST-APLICACIÃ“N

```sql
-- Ejecutar estas consultas para verificar:

-- 1. QuÃ© tablas hay
SELECT GROUP_CONCAT(table_name)
FROM information_schema.tables
WHERE table_schema = DATABASE() AND table_name LIKE 'infoventas_%';

-- 2. QuÃ© incluye la vista
SHOW CREATE VIEW vw_infoventas;

-- 3. Contar registros
SELECT 'vw_infoventas' AS src, COUNT(*) AS qty FROM vw_infoventas
UNION ALL
SELECT 'fact+dev', 
  (SELECT COUNT(*) FROM infoventas_2024_fact) +
  (SELECT COUNT(*) FROM infoventas_2024_dev) +
  (SELECT COUNT(*) FROM infoventas_2025_fact) +
  (SELECT COUNT(*) FROM infoventas_2025_dev);

-- Si ambas suman igual = âœ… CORRECTO
```

---

**Resumen:** El cambio es mÃ­nimo (1 lÃ­nea + 2 condiciones) pero tiene impacto mÃ¡ximo:
- Elimina duplicaciÃ³n de datos
- Garantiza consistencia
- Habilita validaciÃ³n automÃ¡tica
